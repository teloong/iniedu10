---
import Layout from '../layouts/Layout.astro';
---

<Layout title="Daftar - IniEdu">
  <section class="max-w-md mx-auto p-6 bg-white rounded shadow">
    <h1 class="text-2xl font-bold mb-4 text-center">Daftar Akun</h1>
    <div id="message" class="mb-4 text-center text-red-500"></div>
    <form id="register-form" class="space-y-4">
      <input id="email" type="email" placeholder="Email" class="w-full border p-2 rounded" required />
      <input id="password" type="password" placeholder="Password" class="w-full border p-2 rounded" required />
      <button type="submit" class="w-full bg-blue-600 text-white py-2 rounded">Daftar</button>
    </form>
    <p class="mt-4 text-center">
      Sudah punya akun? <a href="/login" class="text-blue-600 underline">Login</a>
    </p>
    <script type="module">
      import { initializeApp, getApps } from 'firebase/app';
      import { getAuth, createUserWithEmailAndPassword, onAuthStateChanged } from 'firebase/auth';

      async function loadFirebaseConfig() {
        return new Promise((resolve) => {
          const script = document.createElement('script');
          script.src = '/firebase-config.js';
          script.onload = () => resolve(window.firebaseConfig);
          document.head.appendChild(script);
        });
      }

      const firebaseConfig = await loadFirebaseConfig();
      const app = getApps().length ? getApps()[0] : initializeApp(firebaseConfig);
      const auth = getAuth(app);

      const messageDiv = document.getElementById('message');
      const form = document.getElementById('register-form');
      form.addEventListener('submit', async (e) => {
        e.preventDefault();
        const email = document.getElementById('email').value;
        const password = document.getElementById('password').value;
        try {
          await createUserWithEmailAndPassword(auth, email, password);
          window.location.href = "/"; // redirect ke halaman utama/profil setelah daftar
        } catch (error) {
          messageDiv.textContent = "Registrasi gagal: " + error.message;
        }
      });

      // Redirect jika sudah login
      onAuthStateChanged(auth, (user) => {
        if (user) {
          window.location.href = "/"; // atau ke /profil
        }
      });
    </script>
  </section>
</Layout>