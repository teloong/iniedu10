---
import Layout from '../../../../layouts/Layout.astro';
---

<Layout title="Video Pembelajaran SD Kelas 1 - Bahasa Indonesia">
  <section class="max-w-2xl mx-auto mt-12 bg-white rounded-2xl shadow-lg p-8">
    <h1 class="text-2xl font-bold text-center mb-6 text-blue-700">Video Pembelajaran SD Kelas 1 - Bahasa Indonesia</h1>
    <div id="video-list" class="space-y-8"></div>
    <div id="video-message" class="text-center text-red-500 mt-6"></div>
    <script type="module">
      import { createClient } from 'https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm';
      const supabaseUrl = 'https://jcfizceoycwdvpqpwhrj.supabase.co';
      const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImpjZml6Y2VveWN3ZHZwcXB3aHJqIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDg1NzUzNzUsImV4cCI6MjA2NDE1MTM3NX0.Au9FzSYvpaX7SkaVrgJvIgK9fZu5Dq4cU_NI5iwY6aA';
      const supabase = createClient(supabaseUrl, supabaseKey);

      const videoList = document.getElementById('video-list');
      const videoMessage = document.getElementById('video-message');

      async function fetchVideos() {
        videoMessage.textContent = '';
        videoList.innerHTML = '';
        const { data, error } = await supabase
          .from('videos')
          .select('*')
          .eq('kelas', '1')
          .ilike('mapel', '%bahasa%indo%');
        if (error) {
          videoMessage.textContent = 'Gagal mengambil data video.';
          return;
        }
        if (!data || data.length === 0) {
          videoList.innerHTML = '<div class="text-center text-gray-500">Belum ada video untuk mapel ini.</div>';
          return;
        }
        data.forEach(video => {
          let videoId = '';
          let embedUrl = video.url;
          if (video.url.includes('youtube.com')) {
            const urlParams = new URLSearchParams(video.url.split('?')[1]);
            videoId = urlParams.get('v');
            embedUrl = `https://www.youtube.com/embed/${videoId}`;
          }
          const div = document.createElement('div');
          div.className = 'p-4 bg-gray-50 rounded shadow';
          div.innerHTML = `
            <div class="font-semibold text-lg mb-2">${video.title}</div>
            <iframe src="${embedUrl}" class="w-full aspect-video rounded mb-2" frameborder="0" allowfullscreen></iframe>
            <div class="text-sm text-gray-600 mb-1">${video.description || ''}</div>
          `;
          videoList.appendChild(div);
        });
      }
      fetchVideos();
    </script>
  </section>
</Layout>
