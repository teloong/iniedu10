---
import AdminLayout from "../layouts/AdminLayout.astro";
import AdminSidebar from "../components/AdminSidebar.astro";
import JwtAuth from "../components/JwtAuth.astro";
import "../styles/global.css";
---

<AdminLayout title="Dashboard Admin">
  <JwtAuth />

  <!-- TAMPILAN DASBOR (SESUAI VERSI LAMA YANG ANDA INGINKAN) -->
  <div class="min-h-screen bg-gray-50 flex">
    <div class="sticky top-0 h-screen hidden md:block">
      <AdminSidebar active="dashboard" />
    </div>
    <main class="flex-1 overflow-x-auto">
      <div class="max-w-7xl mx-auto px-4 py-8">
        <!-- Header dengan nama admin dan tombol logout -->
        <div class="flex justify-between items-center mb-10">
          <h1 class="text-3xl font-bold text-gray-800">
            Selamat Datang, <span id="admin-name">...</span>!
          </h1>
        </div>

        <!-- Statistik Card (dari tampilan lama) -->
        <div
          class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-4 lg:grid-cols-7 gap-6 mb-10"
        >
          <div
            class="bg-white rounded-xl shadow p-6 flex flex-col items-center"
          >
            <div class="mb-2 text-blue-600 text-3xl">
              <svg width="32" height="32" fill="none" viewBox="0 0 24 24"
                ><circle cx="12" cy="12" r="12" fill="#dbeafe"></circle><path
                  d="M12 12a4 4 0 100-8 4 4 0 000 8zm0 2c-3.314 0-6 1.343-6 3v1a1 1 0 001 1h10a1 1 0 001-1v-1c0-1.657-2.686-3-6-3z"
                  fill="#2563eb"></path></svg
              >
            </div>
            <div class="text-sm text-gray-500 mb-1">Total Video</div>
            <div id="total-video-count" class="text-2xl font-bold">-</div>
          </div>
          <div
            class="bg-white rounded-xl shadow p-6 flex flex-col items-center"
          >
            <div class="mb-2 text-yellow-600 text-3xl">
              <svg width="32" height="32" fill="none" viewBox="0 0 24 24"
                ><circle cx="12" cy="12" r="12" fill="#fef9c3"></circle><path
                  d="M7 17V7a2 2 0 012-2h6a2 2 0 012 2v10"
                  stroke="#ca8a04"
                  stroke-width="2.2"
                  stroke-linecap="round"
                  stroke-linejoin="round"></path></svg
              >
            </div>
            <div class="text-sm text-gray-500 mb-1">Total Kursus</div>
            <div id="total-kursus-count" class="text-2xl font-bold">-</div>
          </div>
          <div
            class="bg-white rounded-xl shadow p-6 flex flex-col items-center"
          >
            <div class="mb-2 text-green-600 text-3xl">
              <svg width="32" height="32" fill="none" viewBox="0 0 24 24"
                ><circle cx="12" cy="12" r="12" fill="#dcfce7"></circle><path
                  d="M8 17V7a2 2 0 012-2h4a2 2 0 012 2v10"
                  stroke="#16a34a"
                  stroke-width="2.2"
                  stroke-linecap="round"
                  stroke-linejoin="round"></path></svg
              >
            </div>
            <div class="text-sm text-gray-500 mb-1">Total Blog</div>
            <div id="total-blog-count" class="text-2xl font-bold">-</div>
          </div>
          <div
            class="bg-white rounded-xl shadow p-6 flex flex-col items-center"
          >
            <div class="mb-2 text-purple-600 text-3xl">
              <svg width="32" height="32" fill="none" viewBox="0 0 24 24">
                <circle cx="12" cy="12" r="12" fill="#ede9fe"></circle>
                <path
                  d="M4 7a2 2 0 012-2h6a2 2 0 012 2v10a2 2 0 01-2 2H6a2 2 0 01-2-2V7z"
                  stroke="#7c3aed"
                  stroke-width="2"
                  fill="#fff"></path>
                <path
                  d="M20 7a2 2 0 00-2-2h-4v12h4a2 2 0 002-2V7z"
                  stroke="#7c3aed"
                  stroke-width="2"
                  fill="#fff"></path>
                <path
                  d="M8 7v10"
                  stroke="#7c3aed"
                  stroke-width="1.5"
                  stroke-dasharray="2,2"></path>
              </svg>
            </div>
            <div class="text-sm text-gray-500 mb-1">Total Ebook</div>
            <div id="total-ebook-count" class="text-2xl font-bold">-</div>
          </div>
          <div
            class="bg-white rounded-xl shadow p-6 flex flex-col items-center"
          >
            <div class="mb-2 text-blue-600 text-3xl">
              <svg width="32" height="32" fill="none" viewBox="0 0 24 24"
                ><circle cx="12" cy="12" r="12" fill="#dbeafe"></circle><rect
                  x="7"
                  y="7"
                  width="10"
                  height="10"
                  rx="2"
                  fill="#2563eb"></rect></svg
              >
            </div>
            <div class="text-sm text-gray-500 mb-1">Buku Sekolah</div>
            <div id="buku-sekolah-count" class="text-2xl font-bold">-</div>
          </div>
          <div
            class="bg-white rounded-xl shadow p-6 flex flex-col items-center"
          >
            <div class="mb-2 text-green-600 text-3xl">
              <svg width="32" height="32" fill="none" viewBox="0 0 24 24"
                ><circle cx="12" cy="12" r="12" fill="#dcfce7"></circle><rect
                  x="7"
                  y="7"
                  width="10"
                  height="10"
                  rx="2"
                  fill="#16a34a"></rect></svg
              >
            </div>
            <div class="text-sm text-gray-500 mb-1">Buku Islam</div>
            <div id="buku-islam-count" class="text-2xl font-bold">-</div>
          </div>
          <div
            class="bg-white rounded-xl shadow p-6 flex flex-col items-center"
          >
            <div class="mb-2 text-pink-600 text-3xl">
              <svg width="32" height="32" fill="none" viewBox="0 0 24 24"
                ><circle cx="12" cy="12" r="12" fill="#fce7f3"></circle><rect
                  x="7"
                  y="7"
                  width="10"
                  height="10"
                  rx="2"
                  fill="#e040fb"></rect></svg
              >
            </div>
            <div class="text-sm text-gray-500 mb-1">Buku Anak</div>
            <div id="buku-anak-count" class="text-2xl font-bold">-</div>
          </div>
        </div>

        <div class="text-center text-gray-500 py-10">
          <p>Fitur statistik dan chart sedang dalam pengembangan.</p>
        </div>
      </div>
    </main>
  </div>
</AdminLayout>

<script>
  document.addEventListener("auth-verified", async () => {
    const token = localStorage.getItem("adminAuthToken");
    if (!token) {

      return;
    }

    const updateTextContent = (id: string, value: string | number) => {
      const element = document.getElementById(id);
      if (element) {
        element.textContent = value.toString();
      }
    };

    try {
      const response = await fetch(
        "https://iniedu.id/api/admin/dashboard_stats.php",
        {
          headers: {
            Authorization: `Bearer ${token}`,
          },
        }
      );

      if (!response.ok) {
        throw new Error(`HTTP error! status: ${response.status}`);
      }

      const stats = await response.json();

      // Update card values
      updateTextContent("total-video-count", stats.total_videos || "0");
      updateTextContent("total-blog-count", stats.total_blogs || "0");
      updateTextContent("total-ebook-count", stats.total_ebooks || "0");

      // Update ebook category counts
      updateTextContent(
        "buku-sekolah-count",
        stats.ebooks_by_category["Buku Sekolah"] || "0"
      );
      updateTextContent(
        "buku-islam-count",
        stats.ebooks_by_category["Buku Islam"] || "0"
      );
      updateTextContent(
        "buku-anak-count",
        stats.ebooks_by_category["Buku Anak"] || "0"
      );
    } catch (error) {

      // Optionally, display an error message to the user on the page
    }
  });
</script>
