---
import Layout from '../layouts/Layout.astro';
title: "Blog"
---


<Layout title="Blog">
  {/* ================= Wallpaper Slide Blog (Slideshow) ================= */}
  <div class="relative w-full h-96 md:h-[480px] flex items-center justify-center overflow-hidden mb-8">
    <img id="blog-wallpaper" src="" alt="Wallpaper Blog" class="absolute w-full h-full object-cover opacity-80 transition-all duration-700" />
    <div class="relative z-10 text-center">
      <div class="inline-block px-8 py-6 rounded-2xl backdrop-blur-md bg-white/30 shadow-lg">
        <h1 class="text-4xl md:text-5xl font-extrabold mb-2 py-3 leading-tight bg-gradient-to-r from-blue-500 via-pink-400 to-purple-600 bg-clip-text text-transparent animate-gradient-shimmer text-shadow-strong">
          Blog <span class="inline-block animate-gradient-shimmer-2">IniEdu</span>
        </h1>
      </div>
      <style>
        @keyframes gradient-shimmer {
          0%, 100% { background-position: 0% 50%; }
          50% { background-position: 100% 50%; }
        }
        .animate-gradient-shimmer {
          background-size: 200% 200%;
          animation: gradient-shimmer 3s linear infinite;
        }
        .animate-gradient-shimmer-2 {
          background: linear-gradient(90deg, #f59e42, #65d6ce, #845ec2, #ff6f91, #f59e42);
          background-size: 300% 300%;
          -webkit-background-clip: text;
          -webkit-text-fill-color: transparent;
          animation: gradient-shimmer 4s linear infinite;
        }
        .text-shadow-strong {
          text-shadow: 0 4px 24px rgba(0,0,0,0.45), 0 1px 2px rgba(0,0,0,0.25), 0 0px 2px rgba(0,0,0,0.18);
        }
      </style>
      <p class="text-lg md:text-xl font-semibold mt-2 mb-0 text-blue-700">
        Inspirasi, tips belajar, dan cerita menarik untuk kamu!
      </p>
    </div>
  </div>

  {/* ================= Daftar Postingan Blog ================= */}
  <main class="flex-1 container mx-auto px-4 pb-16">
    <div id="blog-list" class="grid gap-8 md:grid-cols-2 lg:grid-cols-3">
      <div class="col-span-full text-center text-gray-400" id="blog-loading">Loading...</div>
    </div>
  </main>

  {/* ================= Script Slideshow Wallpaper ================= */}
  <script>
    // Array gambar untuk slideshow (bisa diedit nanti)
    const wallpapers = [
      'https://images.unsplash.com/photo-1464983953574-0892a716854b?auto=format&fit=crop&w=1200&q=80',
      'https://images.unsplash.com/photo-1506744038136-46273834b3fb?auto=format&fit=crop&w=1200&q=80',
      'https://images.unsplash.com/photo-1465101046530-73398c7f28ca?auto=format&fit=crop&w=1200&q=80',
      'https://images.unsplash.com/photo-1519125323398-675f0ddb6308?auto=format&fit=crop&w=1200&q=80',
      'https://images.unsplash.com/photo-1522202176988-66273c2fd55f?auto=format&fit=crop&w=1200&q=80'
    ];
    let idx = Math.floor(Math.random() * wallpapers.length);
    const img = document.getElementById('blog-wallpaper');
    if (img && img instanceof HTMLImageElement) {
      img.src = wallpapers[idx];
      setInterval(() => {
        idx = (idx + 1) % wallpapers.length;
        img.classList.add('opacity-0');
        setTimeout(() => {
          img.src = wallpapers[idx];
          img.classList.remove('opacity-0');
        }, 600);
      }, 4000);
    }
  </script>

  {/* ================= Script Load Blog dari Supabase ================= */}
  <script type="module">
    import { createClient } from 'https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm';
    const supabase = createClient(
      'https://jcfizceoycwdvpqpwhrj.supabase.co',
      'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImpjZml6Y2VveWN3ZHZwcXB3aHJqIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDg1NzUzNzUsImV4cCI6MjA2NDE1MTM3NX0.Au9FzSYvpaX7SkaVrgJvIgK9fZu5Dq4cU_NI5iwY6aA'
    );
    async function loadBlogs() {
      const list = document.getElementById('blog-list');
      const loading = document.getElementById('blog-loading');
      const { data, error } = await supabase.from('blog').select('*').order('created_at', { ascending: false });
      if (loading) loading.remove();
      if (error) {
        list.innerHTML = `<div class='col-span-full text-center text-red-600'>Gagal load blog: ${error.message}</div>`;
        return;
      }
      if (!data || data.length === 0) {
        list.innerHTML = `<div class='col-span-full text-center text-gray-400'>Belum ada artikel blog.</div>`;
        return;
      }
      list.innerHTML = '';
      // Fungsi untuk decode HTML entities
      function decodeHtmlEntities(str) {
        const txt = document.createElement('textarea');
        txt.innerHTML = str;
        return txt.value;
      }

      for (const blog of data) {
        const card = document.createElement('article');
        card.className = 'bg-white rounded-xl shadow-lg overflow-hidden hover:shadow-2xl transition-all flex flex-col';

        // Gambar
        if (blog.image) {
          const img = document.createElement('img');
          img.src = blog.image;
          img.alt = blog.title ? decodeHtmlEntities(blog.title.replace(/<[^>]+>/g, '')) : '';
          img.className = 'w-full h-48 object-cover';
          card.appendChild(img);
        }

        // Wrapper konten
        const contentDiv = document.createElement('div');
        contentDiv.className = 'p-6 flex flex-col flex-1';

        // Judul
        const h2 = document.createElement('h2');
        h2.className = 'text-xl font-bold mb-2 text-blue-700 max-w-xs truncate overflow-hidden whitespace-nowrap';
        h2.title = blog.title ? decodeHtmlEntities(blog.title.replace(/<[^>]+>/g, '')) : '';
        h2.textContent = blog.title ? decodeHtmlEntities(blog.title.replace(/<[^>]+>/g, '')) : '';
        contentDiv.appendChild(h2);

        // Deskripsi (tanpa tag HTML)
        const p = document.createElement('p');
        p.className = 'text-gray-600 flex-1';
        // Hilangkan tag HTML dari blog.content
        const plainContent = blog.content.replace(/<[^>]+>/g, '');
        p.textContent = decodeHtmlEntities(plainContent.length > 120 ? plainContent.slice(0,120)+'...' : plainContent);
        contentDiv.appendChild(p);

        // Tombol Baca Selengkapnya
        if (blog.id) {
          const a = document.createElement('a');
          a.href = `/blog-detail?id=${blog.id}`;
          a.className = 'mt-4 inline-block text-blue-600 font-semibold hover:underline cursor-pointer';
          a.textContent = 'Baca Selengkapnya';
          contentDiv.appendChild(a);
        }

        card.appendChild(contentDiv);

        // Footer
        const footer = document.createElement('div');
        footer.className = 'border-t border-gray-200 px-6 py-3 text-xs text-gray-500 flex justify-between items-center';
        const spanDate = document.createElement('span');
        spanDate.textContent = blog.created_at ? new Date(blog.created_at).toLocaleDateString('id-ID', { day:'numeric', month:'long', year:'numeric'}) : '-';
        footer.appendChild(spanDate);
        if (blog.source) {
          const spanSource = document.createElement('span');
          spanSource.className = 'italic text-gray-400';
          spanSource.textContent = blog.source;
          footer.appendChild(spanSource);
        }
        card.appendChild(footer);

        list.appendChild(card);
      }
    }
    document.addEventListener('DOMContentLoaded', loadBlogs);
  </script>
</Layout>