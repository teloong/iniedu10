---
import Layout from "../layouts/Layout.astro";
const title = "Kursus";
---

<Layout title={title}>
  <section
    class="relative min-h-[50vh] flex flex-col items-center justify-center py-16 px-4 bg-gradient-to-br from-blue-50 via-white to-blue-100 overflow-hidden"
    data-aos="fade-up"
  >
    <h1
      class="text-4xl md:text-5xl font-extrabold mb-4 text-[#232b4d] drop-shadow-lg"
      data-aos="fade-right"
    >
      Kursus Unggulan
    </h1>
    <p
      class="mb-10 text-lg md:text-xl text-gray-700 text-center max-w-2xl"
      data-aos="fade-left"
    >
      Temukan berbagai pilihan kursus digital yang interaktif, modern, dan siap
      mengembangkan potensi Anda. Semua tersedia dalam satu platform!
    </p>
    <div class="grid grid-cols-1 md:grid-cols-3 gap-6 w-full max-w-5xl">
      <!-- Card 1: Konten Pembelajaran Digital -->
      <div
        class="bg-white rounded-2xl shadow-xl p-4 md:p-8 flex flex-col items-center transition-all duration-300 border-b-4 border-blue-400 hover:scale-105 hover:-rotate-x-3 hover:rotate-y-3 hover:shadow-[0_8px_32px_0_rgba(0,153,255,0.19),0_2px_12px_0_rgba(0,153,255,0.13)] hover:border-b-[6px] hover:border-blue-500 hover:bg-gradient-to-br hover:from-white hover:to-blue-50 group relative overflow-hidden h-full"
        data-aos="zoom-in"
        data-aos-delay="100"
      >
        <div class="icon-card">
          <img
            src="/images/Konten Pembelajaran Digital.ico"
            alt="Konten Pembelajaran Digital"
          />
        </div>
        <div class="font-bold text-lg mt-4 mb-2 text-blue-700">
          Konten Pembelajaran Digital
        </div>
        <ul class="mb-4 text-base text-gray-700 text-left space-y-2">
          <li class="flex items-start gap-2">
            <svg
              class="w-5 h-5 text-green-500 mt-1"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
              viewBox="0 0 24 24"
              ><circle
                cx="12"
                cy="12"
                r="10"
                stroke="currentColor"
                stroke-width="2"
                fill="#d1fae5"></circle><path
                d="M7 13l3 3 7-7"
                stroke="currentColor"
                stroke-width="2"
                stroke-linecap="round"
                stroke-linejoin="round"></path></svg
            >Video pembelajaran interaktif dan mudah dipahami
          </li>
          <li class="flex items-start gap-2">
            <svg
              class="w-5 h-5 text-blue-500 mt-1"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
              viewBox="0 0 24 24"
              ><rect
                x="3"
                y="7"
                width="18"
                height="13"
                rx="2"
                fill="#e0f2fe"
                stroke="#38bdf8"></rect><path
                d="M16 3v4M8 3v4"
                stroke="#38bdf8"
                stroke-width="2"></path></svg
            >Modul digital lengkap & mudah diakses kapan saja
          </li>
          <li class="flex items-start gap-2">
            <svg
              class="w-5 h-5 text-yellow-500 mt-1"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
              viewBox="0 0 24 24"
              ><path d="M12 20l9-5-9-5-9 5 9 5z" fill="#fef9c3"></path><path
                d="M12 12V4M12 12l9 5-9 5-9-5 9-5z"
                stroke="#facc15"></path></svg
            >Kuis & latihan soal untuk menguji pemahaman
          </li>
          <li class="flex items-start gap-2">
            <svg
              class="w-5 h-5 text-purple-500 mt-1"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
              viewBox="0 0 24 24"
              ><rect
                x="4"
                y="4"
                width="16"
                height="16"
                rx="4"
                fill="#ede9fe"
                stroke="#a78bfa"></rect><path
                d="M8 12h8M12 8v8"
                stroke="#a78bfa"></path></svg
            >Sertifikat digital setelah menyelesaikan kursus
          </li>
        </ul>
        <button
          class="btn-kursus mt-auto px-5 py-2 rounded-full font-semibold shadow-md transition-all duration-200 focus:outline-none focus:ring-4 w-full"
          data-id-kursus="1"
          data-nama-kursus="Konten Pembelajaran Digital">Memuat harga...</button
        >
      </div>
      <!-- Card 2: Simulasi Ujian -->
      <div
        class="bg-white rounded-2xl shadow-xl p-8 flex flex-col items-center transition-all duration-300 border-b-4 border-yellow-400 hover:scale-105 hover:-rotate-x-3 hover:rotate-y-3 hover:shadow-[0_8px_32px_0_rgba(255,179,0,0.17),0_2px_12px_0_rgba(255,179,0,0.13)] hover:border-b-[6px] hover:border-yellow-500 hover:bg-gradient-to-br hover:from-white hover:to-yellow-50 group relative overflow-hidden h-full"
        data-aos="zoom-in"
        data-aos-delay="200"
      >
        <div class="icon-card">
          <img src="/images/Simulasi Ujian.ico" alt="Simulasi Ujian" />
        </div>
        <div class="font-bold text-lg mt-4 mb-2 text-yellow-700">
          Simulasi Ujian
        </div>
        <ul class="mb-4 text-base text-gray-700 text-left space-y-2">
          <li class="flex items-start gap-2">
            <svg
              class="w-5 h-5 text-green-500 mt-1"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
              viewBox="0 0 24 24"
              ><circle
                cx="12"
                cy="12"
                r="10"
                stroke="currentColor"
                stroke-width="2"
                fill="#d1fae5"></circle><path
                d="M7 13l3 3 7-7"
                stroke="currentColor"
                stroke-width="2"
                stroke-linecap="round"
                stroke-linejoin="round"></path></svg
            >Try out online dengan tipe soal terbaru
          </li>
          <li class="flex items-start gap-2">
            <svg
              class="w-5 h-5 text-yellow-500 mt-1"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
              viewBox="0 0 24 24"
              ><path d="M12 20l9-5-9-5-9 5 9 5z" fill="#fef9c3"></path><path
                d="M12 12V4M12 12l9 5-9 5-9-5 9-5z"
                stroke="#facc15"></path></svg
            >Evaluasi otomatis & pembahasan detail tiap soal
          </li>
          <li class="flex items-start gap-2">
            <svg
              class="w-5 h-5 text-blue-500 mt-1"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
              viewBox="0 0 24 24"
              ><rect
                x="3"
                y="7"
                width="18"
                height="13"
                rx="2"
                fill="#e0f2fe"
                stroke="#38bdf8"></rect><path
                d="M16 3v4M8 3v4"
                stroke="#38bdf8"
                stroke-width="2"></path></svg
            >Analisis skor & grafik performa ujian
          </li>
          <li class="flex items-start gap-2">
            <svg
              class="w-5 h-5 text-pink-500 mt-1"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
              viewBox="0 0 24 24"
              ><rect
                x="4"
                y="4"
                width="16"
                height="16"
                rx="4"
                fill="#fce7f3"
                stroke="#f472b6"></rect><path
                d="M8 12h8M12 8v8"
                stroke="#f472b6"></path></svg
            >Rekomendasi materi belajar sesuai hasil try out
          </li>
        </ul>
        <button
          class="btn-kursus mt-auto px-5 py-2 rounded-full font-semibold shadow-md transition-all duration-200 focus:outline-none focus:ring-4 w-full"
          data-id-kursus="2"
          data-nama-kursus="Simulasi Ujian">Memuat harga...</button
        >
      </div>
      <!-- Card 3: Kelas Menulis/Workshop -->
      <div
        class="bg-white rounded-2xl shadow-xl p-8 flex flex-col items-center transition-all duration-300 border-b-4 border-pink-400 hover:scale-105 hover:-rotate-x-3 hover:rotate-y-3 hover:shadow-[0_8px_32px_0_rgba(224,64,251,0.17),0_2px_12px_0_rgba(224,64,251,0.13)] hover:border-b-[6px] hover:border-pink-500 hover:bg-gradient-to-br hover:from-white hover:to-pink-50 group relative overflow-hidden h-full"
        data-aos="zoom-in"
        data-aos-delay="300"
      >
        <div class="icon-card">
          <img
            src="/images/Kelas Menulis Workshop.ico"
            alt="Kelas Menulis / Workshop"
          />
        </div>
        <div class="font-bold text-lg mt-4 mb-2 text-pink-700">
          Kelas Menulis / Workshop
        </div>
        <ul class="mb-4 text-base text-gray-700 text-left space-y-2">
          <li class="flex items-start gap-2">
            <svg
              class="w-5 h-5 text-green-500 mt-1"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
              viewBox="0 0 24 24"
              ><circle
                cx="12"
                cy="12"
                r="10"
                stroke="currentColor"
                stroke-width="2"
                fill="#d1fae5"></circle><path
                d="M7 13l3 3 7-7"
                stroke="currentColor"
                stroke-width="2"
                stroke-linecap="round"
                stroke-linejoin="round"></path></svg
            >Bimbingan menulis langsung dari mentor ahli
          </li>
          <li class="flex items-start gap-2">
            <svg
              class="w-5 h-5 text-yellow-500 mt-1"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
              viewBox="0 0 24 24"
              ><path d="M12 20l9-5-9-5-9 5 9 5z" fill="#fef9c3"></path><path
                d="M12 12V4M12 12l9 5-9 5-9-5 9-5z"
                stroke="#facc15"></path></svg
            >Workshop interaktif & latihan menulis kreatif
          </li>
          <li class="flex items-start gap-2">
            <svg
              class="w-5 h-5 text-blue-500 mt-1"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
              viewBox="0 0 24 24"
              ><rect
                x="3"
                y="7"
                width="18"
                height="13"
                rx="2"
                fill="#e0f2fe"
                stroke="#38bdf8"></rect><path
                d="M16 3v4M8 3v4"
                stroke="#38bdf8"
                stroke-width="2"></path></svg
            >Kolaborasi & diskusi bersama komunitas penulis
          </li>
          <li class="flex items-start gap-2">
            <svg
              class="w-5 h-5 text-purple-500 mt-1"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
              viewBox="0 0 24 24"
              ><rect
                x="4"
                y="4"
                width="16"
                height="16"
                rx="4"
                fill="#ede9fe"
                stroke="#a78bfa"></rect><path
                d="M8 12h8M12 8v8"
                stroke="#a78bfa"></path></svg
            >Portofolio karya & sertifikat workshop eksklusif
          </li>
        </ul>
        <button
          class="btn-kursus mt-auto px-5 py-2 rounded-full font-semibold shadow-md transition-all duration-200 focus:outline-none focus:ring-4 w-full"
          data-id-kursus="3"
          data-nama-kursus="Kelas Menulis / Workshop">Memuat harga...</button
        >
      </div>
    </div>
  </section>

  <script is:inline>
    document.addEventListener("DOMContentLoaded", async () => {
      // --- START PAGE PROTECTION ---
      try {
        const response = await fetch('https://iniedu.id/get_user_session.php', { credentials: 'include' });
        if (!response.ok) {
          throw new Error('Sesi tidak ditemukan, mengalihkan ke halaman login.');
        }
        const userData = await response.json();
        if (!userData || !userData.user_id) {
          throw new Error('Data sesi tidak valid, mengalihkan ke halaman login.');
        }
        // Jika lolos, pengguna terautentikasi. Lanjutkan eksekusi skrip.
      } catch (error) {

        window.location.href = '/login?redirect=/kursus';
        return; // Hentikan eksekusi skrip lebih lanjut
      }
      // --- END PAGE PROTECTION ---
      const base_api_url = "https://iniedu.id"; // Ganti jika URL backend Anda berbeda
      const api_url = `${base_api_url}/get-courses.php`;

      // Pasang event listener SEKALI di luar promise chain
      const courseContainer = document.querySelector('.grid');
      courseContainer.addEventListener('click', (event) => {
          if (event.target.matches('.btn-kursus')) {
              const button = event.target;
              if (button.disabled) return;

              const idKursus = button.dataset.idKursus;
              const namaKursus = button.dataset.namaKursus;
              const harga = button.dataset.harga;
              const isPurchased = button.dataset.purchased === 'true';

              if (isPurchased) {
                  const slug = button.dataset.slug;
                  if (slug) {
                      window.location.href = `/kursus/${slug}`;
                  } else {
                      alert('Gagal membuka materi, URL tidak ditemukan.');
                  }
              } else {
                  if (idKursus && namaKursus && harga) {
                      const courseDetails = { id: idKursus, nama: namaKursus, harga: harga };
                      localStorage.setItem('selectedCourse', JSON.stringify(courseDetails));
                      window.location.href = '/pembayaran';
                  } else {
                      alert('Informasi kursus tidak lengkap. Gagal melanjutkan.');
                  }
              }
          }
      });

      // Ambil data dan perbarui tampilan tombol
      const fetchPurchasedCourses = fetch(`${base_api_url}/get_pembelian_user.php`, { credentials: 'include' }).then(res => res.json());
      const fetchAllCourses = fetch(api_url).then(res => res.json());

      Promise.all([fetchPurchasedCourses, fetchAllCourses])
        .then(([purchasedResult, allCoursesResult]) => {
          if (!allCoursesResult.success || !Array.isArray(allCoursesResult.data)) {
            throw new Error('Gagal memuat daftar semua kursus.');
          }

          const purchasedCourseIds = purchasedResult.success && Array.isArray(purchasedResult.data)
            ? purchasedResult.data.map(course => String(course.id_kursus))
            : [];
          const allCourses = allCoursesResult.data;

          allCourses.forEach(course => {
            const button = document.querySelector(`.btn-kursus[data-id-kursus='${course.id}']`);
            if (!button) return;

            button.dataset.harga = course.harga;
            button.dataset.slug = course.slug;

            if (purchasedCourseIds.includes(String(course.id))) {
              button.textContent = 'Akses Materi';
              button.classList.add('bg-green-500', 'hover:bg-green-600', 'text-white');
              button.classList.remove('bg-blue-500');
              button.dataset.purchased = 'true';
            } else {
              const formattedPrice = new Intl.NumberFormat('id-ID', {
                style: 'currency',
                currency: 'IDR',
                minimumFractionDigits: 0,
              }).format(course.harga);
              button.textContent = `Beli - ${formattedPrice}`;
              button.classList.add('bg-blue-500', 'hover:bg-blue-600', 'text-white');
              button.dataset.purchased = 'false';
            }
          });
        })
        .catch(error => {

          document.querySelectorAll('.btn-kursus').forEach(button => {
            button.textContent = 'Gagal Memuat';
            button.disabled = true;
            button.style.backgroundColor = '#ccc';
          });
        });
    });
  </script>
</Layout>
